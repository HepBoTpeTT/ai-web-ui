#Предисловие
Проект создан в рамках учебного задания и является некоммерческим. В проекте использованы модели и некоторые функции из репозитория <a href="https://huggingface.co/spaces/alibabasglab/ClearVoice/tree/main">ClearVoice</a>;.

#Описание проекта
- Проект представляет из себя последовательно подруженные нейросети <a href="https://huggingface.co/spaces/alibabasglab/ClearVoice/tree/main">ClearVoice</a>; и самостоятельно реализованной и обученной нейросети по определению эмоционального окраса речи записанного человека.
- Проект оснащён неадаптивным web-интерфейсом на flask, т.к. предполагает развёртывание на персональном компьютере из-за требований к вычислительной мощности.

#Краткий мануал по установке и развёртыванию
1. Создание локальной копии репозитория:
   `git clone https://github.com/HepBoTpeTT/ai-web-ui.git`
2. Запустите setup.bat.
   На этом шаге будет создано виртуальное окружение и скачаны необходимые библиотеки.
3. Необходимо отдельно скачать ffmpeg.exe и ffprobe.exe:
    - Скачайте актулальный билд ffmepg по <a href="https://www.gyan.dev/ffmpeg/builds/ffmpeg-git-full.7z">ссылке</a>;
    - Извлеките ffmpeg.exe и ffprobe.exe в venv/Scripts;
4. Готово! Для запуска используйте start.bat

#Как использовать
После запуска start.bat в вашем браузере по умолчанию откроется новая вкладка с интерфейсом проекта. Чтобы начать анализ аудиофайлов, вы можете нажать на кнопку "Выбрать файлы" или перетащить нужные вам файлы в окно браузера. Для обработки доступны **ТОЛЬКО** файлы формата `.wav`.
Далее появится модальное окно с внесёнными файлами. Напротив каждого файла будет чекбокс и кнопка удаления файла из списка обработки. Чекбокс сообщает серверу о необходимости сепарации(диаризации) аудиофайла на 2 дорожки - "оператора" и "клиента", оценка эмоционального окраса будет проведена только с аудиодорожкой "оператора".
Оценка может занять некотрое время - при сепарации(диаризации) обычно она занимает примерно в 5 раз больше длительности аудиофайла.

#Схема работы
После отправки файлов на сервер происходит следующее:
1. Предварительное сохранение файла из браузера в папке temp;
2. Пересохранение аудиофайла в формате `.wav` с частотой дискредитации `16000 Hz`;
3. Сепарация(диаризация) файла с использованием <a href="https://huggingface.co/spaces/alibabasglab/ClearVoice/tree/main">ClearVoice</a>;
4. Очистка звука от помех с использованием <a href="https://huggingface.co/spaces/alibabasglab/ClearVoice/tree/main">ClearVoice</a>;
5. Определение эмоционального окраса аудиозаписи при помощи собственной нейронной сети;
6. Аудиофайлы с негативным эмоциональным окрасом отправляются обратно в пользовательский web-интерфейс, где их можно прослушать и определить правильность оценки.

*Вне зависимости от результата оценки, аудиофайл сохраняется по пути `static/audio_processed/[Имя файла без расширения]/operator.wav`.

#Возможные проблемы при использовании
При использовании вы можете столкнуться с проблемой отсутствия файла модели <a href="https://github.com/modelscope/ClearerVoice-Studio/tree/main/clearvoice">ClearVoice</a>. В таком случае вам нужно будет перейти по <a href="https://huggingface.co/spaces/alibabasglab/ClearVoice/tree/main">ссылке</a> и скачать оттуда модели для `MossFormer2_SS_16K`, `FRCRN_SE_16K`, `AV_MossFormer2_TSE_16K`. После этого разместить их в папках с соответствующим названием в `audio_separation\checkpoints`.
